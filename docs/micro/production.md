# 生产与部署

基座应用和微应用都采用 `服务器/项目名` 的二级目录进行部署

:::tip 重要

如果微应用没有和基座应用部署在同一根目录下，微应用部署的服务器要配置允许跨域访问

因为基座应用要加载微应用的资源，如果微应用的服务器没有配置允许跨域访问，就加载不到微应用，访问出错

:::

一个前端部署目录如下：

![前端项目服务器目录.png](/images/micro/前端项目服务器目录.png)

## 微应用打包

```zsh
npm run build
# 或
yarn build
```

运行打包命令后，框架会以当前系统的命名（package.json 内的 name 属性）为输出目录打包出生产包，且会自动打包出一个 .zip 的压缩包，方便投产

## 基座应用

:::tip

基座应用暂时都由架构组维护，需要更新时，会给到各组生产包，以进行投产

视情况是否对外开发基座应用的代码

:::

基座应用打包&部署与微应用同理

## 关于打包静态资源优化

本身每个微应用是需要加载一些第三方依赖的，如： `vue` / `vuex` / `vue-router` / `jn-ve-global` ...

这些第三方依赖会加大应用的打包体积，会造成如下负面影响：

* 生产包的体积过大，影响基座应用加载微应用的时间（体积越大，加载越慢，造成卡死现象）
* 这些资源基座应用实际已经加载过了，微应用都是重复加载，无意义

基座应用框架与微应用框架都采用了 webpack 的 `externals` ，以排除生产包中的重复第三方依赖，以减小打包体积。

而那些共享的第三方依赖，都提取到了基座应用中，作为静态资源加载到应用中

细心的同学可能注意到，基座应用打出来的包有好几十M，而微应用只有几百k，抽取公用依赖后，微应用的生产包只剩下了自己应用的业务模块

### 微应用引用

微应用在 `index.html` 中，会引用基座应用生产包下的 `lib/xxxxx` 资源，<strong style="color: #ff3040; ">所以一定要将基座应用的部署位置告诉微应用</strong>

通过环境变量 `VUE_APP_BASE_APP_SERVER` 配置

```zsh
# 基座应用部署位置，用来加载静态共享资源，静态共享资源存在于基座应用中
VUE_APP_BASE_APP_SERVER=http://172.31.33.84/basic
```
