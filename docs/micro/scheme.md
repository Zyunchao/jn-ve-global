# 🔨 如何实现微前端

## 微前端模式

微前端的模式大致如下分布

![微前端模式](/images/micro/微前端模式.png)

## 自组织模式

应用之间是平等的，不存在相互管理的模式。设计难度大，不方便实施，但是通用度高。

## 基座模式

:::warning

我们的业务框架也是基座模式，但使用的不是当前二者，当前文档只是帮助大家理解基座模式

:::

通过一个主应用，来管理其它应用。设计难度小，方便实践，但是通用度低。

代表：qiankun、single-spa

虽然 qiankun 与 single-spa 都是基座模式，但是本身的理念又有些许不同

### 微应用维度 Qiankun

它主要解决的是：如何安全、快速的把多个分散的项目集中起来的问题

![微应用维度](/images/micro/微应用维度.png)

所有这些特性都是服务于“微应用加载器”这个定位

### 微模块维度 Single-spa

它主要解决的是：如何实现前端的“微服务化”，从而让应用、组件、逻辑都成为可共享的微服务

![微模块维度](/images/micro/微模块维度.png)

在 single-spa 看来微前端有三种类型：

* 微应用
* 微组件
* 微模块

实际上 single-spa 要求它们都以 SystemJS 的形式打包<br/>
换句话说它们本质上都是 <strong style="color:#ff3040; ">微模块</strong>

### 谁才是微前端？

要讨论这个问题，我们要先想清楚以下两点的区别：

* 微应用加载器：“微”的粒度是应用，也就是HTML（或main.js），它只能做到应用级别的分享
* 微模块加载器：“微”的粒度是模块，也就是JS模块，它能做到模块级别的分享

所以，它们的区别就是微服务的粒度，乾坤的所能服务的粒度是应用级别，而 single-spa 则是模块级别。

那么谁才是微前端呢？答案是：都是。<br/>
因为它们都能将前端进行拆分，只是拆分的粒度不同罢了。但要说谁的微前端更极致，那肯定是 single-spa。

### 立意及区别

乾坤基于single-spa，加强了微应用集成能力，却抛弃了微模块的能力，为什么要这么做呢？我们要想清楚这两个框架出现的背景：

* 乾坤：
    > 阿里内部有大量年久失修的项目，业务侧急需工具去把他们快速、安全的集成到一起。<br/>
    > 在这个角度，乾坤根本没有做模块联邦的需求，它的需求仅仅是如何快速、安全的把项目集成起来。<br/>
    > 所以乾坤是想做一个微前端工具。

* single-spa：
    > 学习后端的微服务，实现前端的微服务化，让应用、组件以及逻辑都成为可共享的微服务，实现真正意义上的微前端。

### 对比图

![乾坤与sspa](/images/micro/乾坤与sspa.png)

### single-spa 加载原理流程图

原 pdf 已给到前端同事

![基座模式微前端流程图](/images/micro/基座模式微前端流程图.png)

## 模块加载模式 Module Federation

我个人认为未来的微前端应该是以模块维度进行搭建的，更极致的模块加载模式也不是 single-spa，而是 webpack5 提供给我们的<strong style="color: #ff3040; ">模块联邦</strong>。<br/>
由于时间关系，以及这是较新的技术，试错成本、开发成本、维护成本，都将是巨大的。

我也尝试了完全使用模块联邦去做微前端，但是已发现的问题就导致了无法进行下去，如：

* 无法动态引入远程的模块
* 产生了循环引用的问题

## MicroApp 基座模式

:::tip

此方案为我们业务框架所采用的，详见 [MicroApp](https://micro-zoe.github.io/micro-app/)

:::

micro-app并没有沿袭single-spa的思路，而是<strong style="color: purple; ">借鉴了WebComponent的思想，通过CustomElement结合自定义的ShadowDom，将微前端封装成一个类WebComponent组件，从而实现微前端的组件化渲染。</strong>

并且由于自定义ShadowDom的隔离特性，micro-app不需要像single-spa和qiankun一样要求子应用修改渲染逻辑并暴露出方法，也不需要修改webpack配置，是目前市面上接入微前端成本最低的方案。

### 概念图

![micro-app-概念图](/images/micro/micro-app-概念图.png)

### 与 qiankun、sspa 的对比

![micro-app-优势对比](/images/micro/micro-app-优势对比.png)

### 流程图

![micro-app-流程图](/images/micro/micro-app-流程图.png)
